---
kind: pipeline
type: vm
name: k8s-monitor

platform:
  os: linux
  arch: amd64

clone:
  depth: 1

steps:

  - name: Docker Dry Run
    image: plugins/docker
    settings:
      repo: supporttools/probe-a-node
      tags:
      - latest
      - ${DRONE_BUILD_NUMBER}
      username:
        from_secret: docker-username
      password:
        from_secret: docker-password
      dockerfile: Dockerfile
      context: .
      pull: true
      dry_run: true
      daemon_off: true
      no_cache: false
      squash: false
      purge: false
      insecure: false
      auto_tag: false
      auto_tag_suffix: latest
      registry: https://index.docker.io/v1/

  - name: Docker Build
    image: plugins/docker
    settings:
      repo: supporttools/probe-a-node
      tags:
      - latest
      - ${DRONE_BUILD_NUMBER}
      username:
        from_secret: docker-username
      password:
        from_secret: docker-password
      dockerfile: Dockerfile
      context: .
      pull: true
      dry_run: false
      daemon_off: true
      no_cache: false
      squash: false
      purge: false
      insecure: false
      auto_tag: false
      auto_tag_suffix: latest
      registry: https://index.docker.io/v1/
    when:
      event:
      - promote
      - deployment
      